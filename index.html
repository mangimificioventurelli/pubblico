<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bilancia</title>

<style>
  body {
    margin: 0;
    background: #111;
    color: #0f0;
    font-family: Arial, sans-serif;
    text-align: center;
  }

  #peso {
    font-size: 64px;
    margin: 40px 0;
  }

  button {
    width: 90%;
    max-width: 400px;
    font-size: 28px;
    padding: 20px;
    margin: 15px auto;
    display: block;
    border-radius: 12px;
    border: none;
  }

  .start { background: #00aa00; color: #fff; }
  .stop  { background: #cc0000; color: #fff; }
  .reset { background: #444; color: #fff; }
</style>
</head>

<body>

<div id="peso">---</div>

<button class="start" onclick="sendCmd('start')">START</button>
<button class="stop"  onclick="sendCmd('stop')">STOP</button>
<button class="reset" onclick="sendCmd('reset')">RESET ALLARMI</button>

<script>
const BASE = "https://travasoventurelli-default-rtdb.europe-west1.firebasedatabase.app";
const PESO_URL = BASE + "/peso.json";
const CMD_URL  = BASE + "/cmd.json";

let lock = false;

/* ===== LETTURA PESO REALTIME ===== */
async function aggiornaPeso() {
  try {
    const r = await fetch(PESO_URL);
    const peso = await r.json();
    if (peso !== null && peso !== "") {
      document.getElementById("peso").innerText = peso;
    }
  } catch (e) {}
}
setInterval(aggiornaPeso, 500);

/* ===== INVIO COMANDI ===== */
async function sendCmd(cmd) {
  if (lock) return;
  lock = true;

  if (navigator.vibrate) navigator.vibrate(30);

  await fetch(CMD_URL, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(cmd)
  });

  setTimeout(() => lock = false, 1000);
}
</script>

</body>
</html>
















