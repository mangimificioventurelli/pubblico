<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Selezione Partenza</title>
<style>
    body {
        font-family: sans-serif;
        background: #f0f0f0;
        display: flex;
        justify-content: center;
        padding: 20px;
    }
    #lista {
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 400px;
    }
    .voce {
        background: #ffffff;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        cursor: pointer;
        transition: 0.2s;
    }
    .voce:hover {
        background: #d0eaff;
    }
</style>
</head>
<body>
<div id="lista"></div>

<script>
// CONFIGURAZIONE FIREBASE
const base = "https://travasoventurelli-default-rtdb.europe-west1.firebasedatabase.app";
const listaUrl = base + "/partenza/filtrata.json";
const selectUrl = base + "/partenza/select.json";
const destSelectUrl = base + "/destinazione/select.json"; // prodotto selezionato in dest

// Legge la lista filtrata
async function fetchLista() {
    try {
        const r = await fetch(listaUrl);
        return await r.json() || [];
    } catch(e) {
        console.error(e);
        return [];
    }
}

// Legge il prodotto selezionato in destinazione
async function fetchProdottoDest() {
    try {
        const r = await fetch(destSelectUrl);
        return await r.json() || "";
    } catch(e) {
        console.error(e);
        return "";
    }
}

// Invia selezione partenza
async function selectIndice(idx) {
    try {
        await fetch(selectUrl, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(idx)
        });
    } catch(e) {
        console.error(e);
    }
}

// Render lista filtrata in base al prodotto selezionato in dest
async function renderLista() {
    const lista = await fetchLista();
    const prodottoDest = await fetchProdottoDest();
    const container = document.getElementById("lista");
    container.innerHTML = "";

    lista.forEach(item => {
        // filtra per prodotto coerente
        if (!item.prodotto || !item.prodotto.includes(prodottoDest)) return;

        const btn = document.createElement("div");
        btn.className = "voce";
        btn.textContent = item.testo;
        btn.onclick = () => selectIndice(item.idx);
        container.appendChild(btn);
    });
}

// Aggiorna ogni secondo
setInterval(renderLista, 1000);
renderLista();
</script>
</body>
</html>
