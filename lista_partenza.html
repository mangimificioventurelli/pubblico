<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Lista Partenze</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #333; padding: 6px 10px; text-align: left; }
  th { background-color: #eee; }
  tr:nth-child(even) { background-color: #f9f9f9; }
</style>
</head>
<body>

<h2>Lista Partenze</h2>
<label>Filtra per prodotto: 
  <input type="text" id="filtroProdotto" placeholder="Inserisci prodotto..." />
</label>

<table id="tabella-lista">
  <thead>
    <tr>
      <th>Testo</th>
      <th>Prodotto</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const firebaseBase = "https://travasoventurelli-default-rtdb.europe-west1.firebasedatabase.app/"; // Cambia con il tuo progetto
const tabella = document.getElementById("tabella-lista").querySelector("tbody");
const inputFiltro = document.getElementById("filtroProdotto");

async function aggiornaLista() {
    try {
        const r = await fetch(firebaseBase + "/partenza/lista.json");
        const lista = await r.json();
        if (!lista) return;

        const filtro = inputFiltro.value.toUpperCase();

        tabella.innerHTML = ""; // Pulisce la tabella

        lista.forEach(item => {
            // Se prodotto non esiste in Firebase, usiamo testo completo come fallback
            const prodotto = item.prodotto || item.testo;

            if (filtro === "" || prodotto.toUpperCase().includes(filtro)) {
                const tr = document.createElement("tr");
                const tdTesto = document.createElement("td");
                const tdProdotto = document.createElement("td");

                tdTesto.innerText = item.testo;
                tdProdotto.innerText = prodotto;

                tr.appendChild(tdTesto);
                tr.appendChild(tdProdotto);
                tabella.appendChild(tr);
            }
        });

    } catch (e) {
        console.error("Errore nel fetch Firebase:", e);
    }
}

// Aggiorna ogni secondo
setInterval(aggiornaLista, 1000);

// Aggiorna al cambio filtro
inputFiltro.addEventListener("input", aggiornaLista);
</script>

</body>
</html>
